# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Moiraine is a WordPress block theme based on the Ollie theme by Mike McAlister. It's designed to work with WordPress's block editor and site editor, providing over 50 patterns, templates, and style variations for building custom websites without coding.

## Development Commands

### Node.js Development Workflow
- `npm install` - Install Node.js dependencies for development tools
- `npm run dev` - Watch pattern files for changes and auto-escape for translations
- `npm run translate:patterns` - Process pattern files for translation readiness

### Linting and Code Quality
- `composer run lint` - Run PHP parallel lint on all PHP files
- `composer run wpcs:scan` - Scan code against WordPress coding standards
- `composer run wpcs:fix` - Auto-fix WordPress coding standard violations

**WPCS Requirements for Blocks and Code:**
- All PHP code must follow WordPress Coding Standards (WPCS)
- Block build files (`inc/blocks/*/build/*`) are excluded from WPCS as they're generated by `@wordpress/create-block`
- Only edit source files in `inc/blocks/*/src/` - never edit build files directly
- Run `composer run wpcs:fix` to auto-fix most violations before committing
- WPCS is enforced in CI/CD pipeline via GitHub Actions

### Block Development Workflow
- `cd inc/blocks/[block-name]` - Navigate to block directory
- `npm install` - Install block dependencies
- `npm start` - Development mode with file watching
- `npm run build` - Production build (compiles src/ to build/)
- `npm run lint:js` - JavaScript linting
- `npm run lint:css` - CSS/SCSS linting
- `npm run format` - Code formatting

### Block Registration
Custom blocks must be registered with WordPress. Three main approaches:

**Single Block Registration**:
```php
function register_my_block() {
    register_block_type( __DIR__ . '/inc/blocks/my-block/build/my-block/block.json' );
}
add_action( 'init', 'register_my_block' );
```

**Auto-scan Multiple Blocks** (recommended for themes):
```php
add_action('init', function () {
    $blocks_dir = get_template_directory() . '/inc/blocks';
    if (!is_dir($blocks_dir)) return;

    foreach (scandir($blocks_dir) as $folder) {
        if ($folder === '.' || $folder === '..') continue;

        $block_json_path = $blocks_dir . '/' . $folder . '/build/' . $folder . '/block.json';
        if (file_exists($block_json_path)) {
            register_block_type($block_json_path);
        }
    }
});
```

**Block Manifest** (WordPress 6.7+, most efficient):
```php
function register_theme_blocks() {
    if (function_exists('wp_register_block_types_from_metadata_collection')) {
        wp_register_block_types_from_metadata_collection(__DIR__ . '/build', __DIR__ . '/build/blocks-manifest.php');
    }
}
add_action('init', 'register_theme_blocks');
```

### Installation
- `composer install` - Install PHP dependencies for development
- `composer require imagewize/moiraine` - Install theme via Composer

## Architecture Overview

### Core Files
- `functions.php` - Main theme functionality including block styles, pattern categories, and WordPress hooks
- `theme.json` - WordPress theme configuration defining colors, typography, layout settings, and global styles
- `style.css` - Main theme stylesheet and WordPress theme header
- `theme-utils.mjs` - Node.js utility for pattern translation and file watching
- `package.json` - NPM configuration for development workflow

### Directory Structure
- `patterns/` - 88+ block patterns organized by category (hero, features, pricing, menu, etc.)
- `templates/` - WordPress block theme templates (page, single, archive, etc.)
- `parts/` - Template parts (header, footer, sidebar)
- `styles/` - Theme style variations and block-specific styles
- `assets/` - Theme assets including block-specific CSS files

### Block Theme Architecture
This is a WordPress block theme that uses:
- **Block patterns** for pre-designed page sections
- **Template parts** for reusable components (header, footer, sidebar)
- **Global styles** via theme.json for consistent design system
- **Block styles** for visual variations of core WordPress blocks

### Pattern System
Patterns are organized into categories:
- `moiraine/hero` - Hero sections
- `moiraine/features` - Feature presentations
- `moiraine/call-to-action` - CTA sections
- `moiraine/card` - Card layouts
- `moiraine/pricing` - Pricing tables
- `moiraine/testimonial` - Testimonials
- `moiraine/posts` - Blog post layouts
- `moiraine/pages` - Full page layouts
- `moiraine/menu` - Navigation and menu patterns (14 patterns: cards, mobile, panels)

### Block Styles System
Custom block styles are registered in functions.php and loaded dynamically:
- List styles (check, boxed)
- Cover styles (blur, rounded)
- Image styles (rounded, boxed)
- Code styles (dark theme)
- Group styles (box shadow, background blur)

### Style Variations
Multiple style variations available in `styles/` directory:
- Agency, Consulting, Creator, Startup, Studio
- Color variations in `styles/colors/`

## Development Notes

- WordPress 6.0+ required
- PHP 7.3+ required
- Node.js for development workflow (pattern translation, file watching)
- Uses WordPress coding standards (WPCS)
- Patterns directory excluded from linting
- No build process required - works out of the box
- Uses namespaced functions under `Moiraine\` namespace

## Enhanced Features

### WooCommerce Integration
- Automatic WooCommerce stylesheet loading when plugin is active
- Enhanced e-commerce support for online stores

### Typography System
- 9 typography preset variations in `styles/typography/`
- Professional font combinations for different design needs
- Accessible via WordPress Site Editor Global Styles

### Menu Patterns
- 14 specialized navigation patterns for professional menu design
- Mobile-responsive menu variations
- Card, panel, and mobile menu styles

### Block Development
- Uses `@wordpress/create-block` for custom block development
- Block source files in `inc/blocks/*/src/` directories
- Build output auto-generated in `inc/blocks/*/build/` directories
- **IMPORTANT**: Never edit build files directly - always edit source files in `src/` and run `npm run build`
- Build process compiles TypeScript/JSX, processes SCSS, and generates block manifest
- Use `npm start` for development (watches files and rebuilds automatically)
- Use `npm run build` for production builds before committing
- Blocks must be registered with WordPress using `register_block_type()` function