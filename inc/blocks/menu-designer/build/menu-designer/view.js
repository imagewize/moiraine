import{getContext as e,getElement as n,store as i}from"@wordpress/interactivity";const{state:t,actions:o}=i("moiraine/menu-designer",{state:{get isMenuOpen(){return Object.values(t.menuOpenedBy).filter(Boolean).length>0},get menuOpenedBy(){return e().menuOpenedBy||{}},get menuPosition(){return e().menuPosition||"left"}},actions:{toggleMenuOnClick(){const i=e(),{ref:u}=n();t.menuOpenedBy.click||t.menuOpenedBy.focus?o.closeMenuOnClick():(i.previousFocus=u,o.openMenu("click"))},closeMenuOnClick(){o.closeMenu("click"),o.closeMenu("focus")},handleMenuKeydown(e){t.menuOpenedBy.click&&"Escape"===e?.key&&o.closeMenuOnClick()},handleOutsideClick(n){const i=e(),t=i?.megaMenu;t&&!t.contains(n.target)&&o.closeMenuOnClick()},openMenu(e="click"){o.calculateMenuPosition(),t.menuOpenedBy[e]=!0},calculateMenuPosition(){const i=e(),{ref:t}=n(),o=t.querySelector(".wp-block-moiraine-menu-designer__toggle"),u=t.querySelector(".moiraine-menu-designer, .wp-block-moiraine-menu-designer__menu-container");if(!o||!u)return;const c=o.getBoundingClientRect(),s=window.innerWidth,l=u.offsetWidth||400,r=c.left,a=s-c.right,d=c.left+c.width/2,m=s/2;let M="left";a<l&&r>l?M="right":Math.abs(d-m)<100&&r>l/2&&a>l/2?M="center":l>.6*s&&d>m&&(M="right"),i.menuPosition=M},closeMenu(n="click"){const i=e();t.menuOpenedBy[n]=!1,t.isMenuOpen||(i.megaMenu?.contains(window.document.activeElement)&&i.previousFocus?.focus(),i.previousFocus=null,i.megaMenu=null)}},callbacks:{initMenu(){const i=e(),{ref:u}=n();t.isMenuOpen&&(i.megaMenu=u),i.resizeListenerAdded||(i.resizeListenerAdded=!0,window.addEventListener("resize",()=>{t.isMenuOpen&&o.calculateMenuPosition()}))}}});